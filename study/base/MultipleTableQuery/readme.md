# MultipleTableQuery

多表查询

## 多表关系

- 概述： 项目开发中在进行数据库表结构设计时，会根据业务需求及业务模块之间的关系，分析并设计表结构，由于业务之间相互关联，所以各个表结构之间也存在着各种联系，基本上分为三种：
    - 一对多（多对一）
        - 案例：部门与员工的关系
        - 关系：一个部门对应多个员工，一个员工对应多个部门
        - 实现：**在多的一方建立外键，指向一的一方的主键**
    - 多对多
        - 案例：学生与课程的关系
        - 关系：员工学生可以选修多门课程，一门课程也可以供多个学生选择
        - 实现：建立第三张中间表，中间表至少包含两个外键，分别关联两方主键
    - 一对一
        - 案例：用户与用户详情的关系
        - 关系：一对一的关系，多用于单表拆分，将一张表的基础字段放在一张表中，其他详情字段放在另一张表中，以提升操作效率
        - 实现：**在任意一方加入外键，关联另一方的主键，并且设置外键为唯一的（UNIQUE）**

## 多表查询概述

- 概述：指从多张表中查询数据
- 笛卡尔积：笛卡尔乘积是指在数学中，两个集合，A集合B集合的所有组合情况（**在多表查询时，需要消除无效的笛卡尔积**）
- 多表查询分类
    - 连接查询
        - 内连接：相当于查询A、B交集部分的数据
        - 外连接：
            - 左外连接：查询A表所有数据，以及两张表交集部分数据
            - 右外连接：查询B表所有数据，以及两张表交集部分数据
        - 自连接：当前表与自身的连接查询，自连接必须使用表别名
    - 子查询

### 连接查询——内连接

内连接查询的是两张表交集的部分

内连接查询语法：

- 隐式内连接
  `SELECT 字段列表 FROM 表1, 表2 WHERE 条件 ...;`
- 显式内连接
  `SELECT 字段列表 FROM 表1 [INNER] JOIN 表2 ON 连接条件 ...;`

### 外连接

查询表1（左表）/2（右表）的所有数据，包含表1和表2交集部分的数据

外连接查询语法：

- 左外连接（表1/左表）
  `SELECT 字段列表 FROM 表1 LEFT [OUTER] JOIN 表2 ON 条件 ...;`
- 右外连接（表2/右表）
  `SELECT 字段列表 FROM 表1 RIGHT [OUTER] JOIN 表2 ON条件 ...;`

左外和右外可以通过调换表1和表2的顺序实现相同的查询结果

### 自连接

自连接查询，可以是内连接查询，也可以是外连接查询

自连接查询语法：

- 自连接——交集部分
  `SELECT 字段列表 FROM 表A 别名A, 表A 别名B WHERE 条件 ...;`
- 自连接——非交集部分+交集部分
  `SELECT 字段列表 FROM 表A 别名A JOIN 表A 别名B ON 条件 ... ;`

### 连接查询拓展——联合查询（union，union all）
对于union查询，就是把多次查询的结果合并起来，形成一个新的查询结果集

```mysql
SELECT 字段列表
FROM 表A ... UNION [ALL] 
SELECT 字段列表 FROM 表B ...;
```
**对于联合查询的多张表的列数必须保持一致，字段类型也需要保持一致**

**union all会将全部的数据直接合并在一起，union会对合并之后的数据去重**
### 子查询
- 概念：SQL语句中嵌套SELECT语句，又称为**嵌套查询**，又称**子查询**
`SELECT * FROM t1 WHERE column1 = (SELECT column1 FROM t2);`
**子查询外部的语句可以是INSERT/DELETE/UPDATE/SELECT中的任何一个**
- 根据子查询结果不同，分为：
  - 标量子查询（子查询结果为单个值）
  - 列子查询（子查询结果为一列）
  - 行子查询（子查询结果为一行）
  - 表子查询（子查询结果为多行多列）
- 根据子查询位置，分为：WHERE之后、FROM之后、SELECT之后
#### 标量子查询
子查询返回的结果是单个值（数字、字符串、日期等），最简单的形式，这种子查询称为**标量子查询**

常用的操作符：= <> > >= < <=
#### 列子查询
子查询返回的结果是一列（可以是多行），这种子查询称为**列子查询**

常用的操作符：IN、NOI IN、ANY、SOME、ALL

| 操作符    | 描述                        |
|--------|---------------------------|
| IN     | 在指定的集合范围之内，多选一            |
| NOT IN | 不在指定的集合范围之内               |
| ANY    | 子查询返回列表中，有任意一个满足即可        |
| SOME   | 与ANY等同，使用SOME的地方都可以使用SOME |
| ALL    | 子查询返回列表的所有值都必须满足          |
#### 行子查询
子查询返回的结果是一行（可以是多列 ），这种子查询称为**行子查询**

常用的操作符：=、<>、IN、NOT IN
#### 表子查询
子查询返回的结果是多行多列，这种子查询称为**表子查询**

常用的操作符：IN

























