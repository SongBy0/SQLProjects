/*查询插入功能语句*/
/*根据ppt出现的顺序*/
/*
    以下为传入的参数都使用具体值代替

*/

/*分解功能*/
/*根据用户账号得到用户的id*/
select u.id
from user u
where u.user_id = '1000002020';

/*根据用户账号得到该教师授课的所有课程ID*/
select tc.id teach_id
from teach_course tc
where tc.teacher_id = (select u.id from user u where u.user_id = '1000002020');

/*根据用户账号得到教师授课的所有专业ID*/
select distinct tc.subject_id
from teach_course tc
where (tc.teacher_id = (select ter.id from user ter where ter.user_id = '1000002020'));

/*根据专业名查询专业ID*/
select sub.id
from subject sub
where sub.name = '计算机';

/*查询某教师所授专业名*/
select distinct sub.name
from subject sub,
     (select distinct tc.subject_id
      from teach_course tc
      where tc.teacher_id = (select ter.id from user ter where ter.user_id = '1000002020')) tc_s
where sub.id = tc_s.subject_id;

/*根据课程名查课程id*/
select c.id
from course c
where c.name = '高等数学';

/*查询该教师教的某个专业下的所有授课id*/
select distinct ter.course_id
from teach_course ter
where teacher_id = (select u.id
                    from user u
                    where u.user_id = '1000002020')
  and subject_id = (select sub.id
                    from subject sub
                    where sub.name = '计算机');

/*查询某个教师某门授课的id*/
select tc.id
from teach_course tc
where tc.teacher_id = (select u.id
                       from user u
                       where u.user_id = '1000002020')
  and course_id = (select c.id
                   from course c
                   where c.name = '高等数学');

/*通过试卷号查询课程ID*/
select course_id
from teach_course tc
where id in (select teach_id from test_paper);

/*通过试卷号查询课程名*/
select c.name, tp_tc.*
from course c,
     (select course_id
      from teach_course tc
      where id in (select teach_id from test_paper)) tp_tc
where c.id = tp_tc.course_id;

/*查询某个教师的某个课程的所有试卷ID*/
select tp.id
from test_paper tp
where tp.teach_id in (select tc.id
                      from teach_course tc
                      where tc.teacher_id = (select ter.id
                                             from user ter
                                             where ter.user_id = '1000002020')
                        and tc.course_id = (select c.id
                                            from course c
                                            where c.name = '高等数学'));
/*此处的 '1000002020' 根据用户的账号而改变；'高等数学' 根据用户选择的课程而改变*/

/*查询某个教师的某个专业的某个课程的所有试卷ID*/
select tp.id
from test_paper tp
where tp.teach_id in (select tc.id
                      from teach_course tc
                      where tc.teacher_id = (select ter.id
                                             from user ter
                                             where ter.user_id = '1000002020')
                        and tc.subject_id = (select sub.id
                                             from subject sub
                                             where sub.name = '计算机')
                        and tc.course_id = (select c.id
                                            from course c
                                            where c.name = '高等数学'));
/*此处的 '1000002020' 根据用户的账号而改变；'计算机' 根据用户选择的专业而改变；*/

/*查询某个老师所授的所有专业ID*/
select distinct subject_id
from teach_course
where teacher_id = (select id
                    from user u
                    where u.user_id = '1000002020');


/*某个老师所授的某个专业的所有课程ID*/
select tc.id, subject_id
from teach_course tc
where tc.teacher_id = (select id
                       from user u
                       where u.user_id = '1000002020')
  and tc.subject_id = (select sub.id
                       from subject sub
                       where sub.name = '计算机');
/*此处的 '计算机' 为用户选择计算机专业*/

/*查询某个教师的某个专业的所有试卷ID*/
select tp.id
from test_paper tp,
     (
         select tc.id, tc.subject_id
         from teach_course tc
         where tc.teacher_id = (select id
                                from user u
                                where u.user_id = '1000002020')
           and tc.subject_id = (select sub.id
                                from subject sub
                                where sub.name = '计算机')) tc_sub
where tp.teach_id in (tc_sub.id);

/*查询某个教师某个专业的所有课程号*/
select distinct tc.id
from teach_course tc
where tc.teacher_id = (select id
                       from user u
                       where u.user_id = '1000002020')
  and tc.subject_id = (select sub.id
                       from subject sub
                       where sub.name = '计算机');

/*根据试卷名得到试卷ID*/
select tp.id
from test_paper tp
where tp.name = '2020-2021年数据库1';

/*通过试卷ID和题序得到一个问题ID*/
select q.id
from question q
where q.test_id = 6
  and q.sort = 2;

/*通过试卷ID获得所有题序*/
select q.sort
from question q
where test_id = 6;

/*实现功能*/
/*登录判断*/
/*查询指定用户的登录密码是否正确，正确得到1，错误得到0，无此账号得到null*/
select if(u.password = '123456', 1, 0) as 'check_password'
from user u
where (u.user_id = '0000000001' and u.user_role = 0 and u.status = 1);
/*此处的 123456 和 0000000001 根据用户输入的账号密码而改变*/

/*题库管理*/
/*挑选主分类专业*/
/*查询某个老师所授的所有专业名*/
select sub.name
from subject sub
where sub.id in (select distinct subject_id
                 from teach_course
                 where teacher_id = (select u.id from user u where u.user_id = '1000002020'));
/*此处的 '1000002020' 根据用户的账号而改变*/


/*挑选子分类课程*/
/*查询某个老师所授某个专业的所有课程名*/
select distinct c.name
from teach_course tc,
     course c
where tc.teacher_id = (select id
                       from user u
                       where u.user_id = '1000002020')
  and tc.subject_id = (select sub.id
                       from subject sub
                       where sub.name = '计算机')
  and tc.course_id = c.id;
/*此处的 '1000002020' 根据用户的账号而改变，此处的 '计算机' 根据用户的选择而改变*/

/*左侧显示*/
/*查询该教师所授课的某个专业名及试卷总数*/
select sub.name, count(tp.id)
from test_paper tp,
     subject sub,
     (select tc.id, tc.subject_id
      from teach_course tc
      where tc.teacher_id = (select id
                             from user u
                             where u.user_id = '1000002020')
        and tc.subject_id = (select sub.id
                             from subject sub
                             where sub.name = '计算机')) tc_sub
where tp.teach_id in (tc_sub.id)
  and sub.id = tc_sub.subject_id;
/*此处的 '1000002020' 根据用户的账号而改变，此处的 '计算机' 根据用户的选择而改变*/

/*查询该教师所授课的某个专业的某门课程及其试卷总数*/
select c.name, count(tp.id)
from test_paper tp,
     course c,
     (select distinct tc.id, tc.course_id
      from teach_course tc
      where tc.teacher_id = (select id
                             from user u
                             where u.user_id = '1000002020')
        and tc.subject_id = (select sub.id
                             from subject sub
                             where sub.name = '计算机')) tc_c_id
where c.id = tc_c_id.course_id
  and tp.teach_id = tc_c_id.id
group by c.name;

/*查询该教师所授课的所有专业的所有课程及其试卷总数*/
/*
    暂未实现
*/

/*右侧显示试卷信息*/
/*根据专业课程显示*/
select tp.name, tp.score, c.name, tc_tp.teacher_id, tp.create_time
from test_paper tp,
     subject sub,
     course c,
     (select tc.id, tc.subject_id, tc.course_id, tc.teacher_id
      from teach_course tc
      where tc.teacher_id = (select id
                             from user u
                             where u.user_id = '1000002020')
        and tc.subject_id = (select sub.id
                             from subject sub
                             where sub.name = '计算机')) tc_tp
where tp.teach_id in (tc_tp.id)
  and sub.id = tc_tp.subject_id
  and c.id = tc_tp.course_id
  and c.name = '数据库基础'
order by create_time desc
limit 0,9;
/*此处的 '1000002020' 根据用户的账号而改变，此处的 '计算机'、'数据库基础' 根据用户的选择而改变，0 为(查询页数-1)*每页显示数*/

/*根据专业显示*/
select tp.name, tp.score, c.name, tc_tp.teacher_id, tp.create_time
from test_paper tp,
     course c,
     (select distinct tc.id, tc.course_id, tc.teacher_id
      from teach_course tc
      where tc.teacher_id = (select id
                             from user u
                             where u.user_id = '1000002020')
        and tc.subject_id = (select sub.id
                             from subject sub
                             where sub.name = '计算机')) tc_tp
where c.id = tc_tp.course_id
  and tp.teach_id = tc_tp.id
order by create_time desc
limit 0,9;
/*此处的 '1000002020' 根据用户的账号而改变，此处的 '计算机' 根据用户的选择而改变，0 为(查询页数-1)*每页显示数*/

/*根据试卷名查找*/
select tp.name, tp.score, c.name, tc.teacher_id, tp.create_time
from test_paper tp,
     course c,
     teach_course tc
where tc.teacher_id = (select id
                       from user u
                       where u.user_id = '1000002020')
  and tc.course_id = c.id
  and tp.teach_id = tc.id
  and tp.name like '%数%'
order by create_time desc
limit 0,9;
/*此处的 '1000002020' 根据用户的账号而改变，'数据库' 为用户的搜索栏输入*/

/*右侧编辑*/
/*试卷详情*/
/*根据试卷名查询所有题序*/
select q.sort
from question q
where test_id = (select tp.id
                 from test_paper tp
                 where tp.name = '2020-2021年数据库1');
/*此处 '2020-2021年数据库1' 为用户选择的试卷名*/

/*根据试卷名和题序查询问题详情*/
select q.topic, q.answer
from question q
where q.test_id = (select tp.id
                   from test_paper tp
                   where tp.name = '2020-2021年数据库1')
  and q.sort = 1;
/*此处 '2020-2021年数据库1' 为用户选择的试卷名，'1' 为用户选择的题序*/

/*根据试卷名和题序查询主观题分数和关键词*/
select wo.score, wo.word_options
from word_options wo
where wo.question_id = (select q.id
                        from question q
                        where q.test_id = (select tp.id
                                           from test_paper tp
                                           where tp.name = '2020-2021年数据库1')
                          and q.sort = 1)
  and wo.type = 1;
/*此处 '2020-2021年数据库1' 为用户选择的试卷名，q.sort='1' 为用户选择的题序*/

/*根据试卷名和题序查询客观题选项*/
select wo.word_options
from word_options wo
where wo.question_id = (select q.id
                        from question q
                        where q.test_id = (select tp.id
                                           from test_paper tp
                                           where tp.name = '2020-2021年数据库1')
                          and q.sort = 1)
  and wo.type = 2;
/*此处 '2020-2021年数据库1' 为用户选择的试卷名，'1' 为用户选择的题序*/

/*右侧删除*/
delete
from test_paper tp
where tp.name = '2020-2021年数据库1';
/*此处 '2020-2021年数据库1' 为用户选择的试卷名*/